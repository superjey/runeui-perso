!function(a){"use strict";var b=function(b,c){this.$element=a(b),this.options=c,this.before=this.options.before||this.before,this.onItem=this.options.onItem||this.onItem,this.options.target&&this.$element.attr("data-target",this.options.target),this.listen()};b.prototype={constructor:b,show:function(b){var d,f,c=a(this);if(!c.is(".disabled, :disabled")&&(f=a.Event("context"),this.before.call(this,b,this.$element))){this.$element.trigger(f),d=this.getMenu();var g=this.getPosition(b,d);return d.attr("style","").css(g).addClass("open"),!1}},closemenu:function(){this.getMenu().removeClass("open")},before:function(){return!0},onItem:function(){return!0},listen:function(){var b=this;this.$element.on("contextmenu.context.data-api",a.proxy(this.show,this)),a("html").on("click.context.data-api",a.proxy(this.closemenu,this));var c=a(this.$element.attr("data-target"));c.on("click.context.data-api",function(c){b.onItem.call(this,c,a(c.target))}),a("html").on("click.context.data-api",function(a){a.ctrlKey||c.removeClass("open")})},getMenu:function(){var c,b=this.$element.attr("data-target");return b||(b=this.$element.attr("href"),b=b&&b.replace(/.*(?=#[^\s]*$)/,"")),c=a(b)},getPosition:function(b,c){var i,j,d=a(document).height(),e=c.find(".dropdown-menu").outerWidth(),f=c.find(".dropdown-menu").outerHeight(),g=GUI.DBentry[2],h={position:"absolute"};return i={left:GUI.DBentry[1]-e+20},j=g+f>d?{top:d-f}:{top:g-1},a.extend(h,j,i)},clearMenus:function(b){b.ctrlKey||a("[data-toggle=context]").each(function(){this.getMenu().removeClass("open")})}},a.fn.contextmenu=function(c,d){return this.each(function(){var e=a(this),f=e.data("context"),g="object"==typeof c&&c;f||e.data("context",f=new b(this,g)),"string"==typeof c&&f[c].call(f,d)})},a.fn.contextmenu.Constructor=b,a(document).on("click.context.data-api","[data-toggle=context]",function(b){var c=a(this).offset();GUI.DBentry[1]=c.left,GUI.DBentry[2]=c.top,a(this).contextmenu("show",b),b.preventDefault()})}(window.jQuery);